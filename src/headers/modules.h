#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "../globals/variables.h"

// Print Colors
#define RED(string)     "\x1b[31m" string "\x1b[0m"
#define GREEN(string)   "\x1b[32m" string "\x1b[0m"
#define YELLOW(string)  "\x1b[33m" string "\x1b[0m"
#define BLUE(string)    "\x1b[34m" string "\x1b[0m"
#define MAGENTA(string) "\x1b[35m" string "\x1b[0m"
#define CYAN(string)    "\x1b[36m" string "\x1b[0m"


// Initialise Global Variables
static inline void INIT_SERVER(struct SERVER_FLAGS *SERVER, char *url)
{
  // Initialize Server Flags
  SERVER->VERSION_FLAG=0;
  SERVER->VULN_FLAG=0;
  SERVER->SSL_FLAG=0;

  // Initialize URL
  URL = (char *)malloc(strlen(url)+1);
  if (URL == NULL)
  {
    fprintf(stderr, "[-] "RED("malloc() Failed!" "\n"));
    exit(EXIT_FAILURE);
  }
  strcpy(URL,url);
}

// Intialise Chunks
static inline void INIT_CHUNCK(struct chunck *s) 
{
  s->len = 0;
  s->ptr = malloc(s->len+1);
  if (s->ptr == NULL) 
  {
    fprintf(stderr, "[-] "RED("malloc() Failed!" "\n"));
    exit(EXIT_FAILURE);
  }
  s->ptr[0] = '\0';
}

// Check If Server Is Running In SSL Mode
static inline void CHECK_SSL_MODE(char *resp)
{
  if (strstr(resp,"server is running in SSL mode")!=NULL)
  {
    SERVER.SSL_FLAG=1;
  }
}

// Switch to HTTPS:
static inline void SWITCH_TO_SSL()
{
  char temp[strlen(URL)+2];
  bzero(temp,strlen(URL)+2);
  if(strncmp(URL,"http://",7*sizeof(char))==0)
  {
    strcpy(temp+1,URL);
    memcpy(temp,URL,5*sizeof(char));
    temp[4]='s';
    

    URL=(char *)realloc(URL,strlen(temp)+1);
    memcpy(URL,temp,sizeof(temp));
  }
}

static inline void CLEANUP()
{
  if (URL != NULL)
  {
    free(URL);
  }
}