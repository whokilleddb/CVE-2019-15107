#include <curl/curl.h>
#include <curl/easy.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define RED(string)     "\x1b[31m" string "\x1b[0m"
#define GREEN(string)   "\x1b[32m" string "\x1b[0m"
#define YELLOW(string)  "\x1b[33m" string "\x1b[0m"
#define BLUE(string)    "\x1b[34m" string "\x1b[0m"
#define MAGENTA(string) "\x1b[35m" string "\x1b[0m"
#define CYAN(string)    "\x1b[36m" string "\x1b[0m"

struct IS_VULN{
  int VULN_VERSION;
  int IS_VULN;
};

struct IS_VULN is_vuln;

static inline size_t CHECK_HEADERS(char *buffer, size_t itemsize, size_t nitems, void* ign)
{
  size_t bytes=itemsize*nitems;

  fprintf(stdout,GREEN("%s"),buffer);
  if (strstr(buffer,"Server:")!=NULL)
  {
    if ((strstr(buffer,"MiniServ/1.890")!=NULL) || (strstr(buffer,"MiniServ/1.900")!=NULL) || (strstr(buffer,"MiniServ/1.910")!=NULL) || (strstr(buffer,"MiniServ/1.920")!=NULL))
    {
        is_vuln.VULN_VERSION=1;
    }
  }
  return bytes;
}


static inline int CHECK_VERSION(char *url)
{
  CURLcode ret;
  CURL *hnd;

  hnd = curl_easy_init();
  if (!hnd){
    fprintf(stderr,"[-]" RED("Curl init failed") "\n");
    return EXIT_FAILURE;
  }
    
  curl_easy_setopt(hnd, CURLOPT_BUFFERSIZE, 102400L);
  curl_easy_setopt(hnd, CURLOPT_URL, url);
  curl_easy_setopt(hnd, CURLOPT_NOPROGRESS, 1L);
  curl_easy_setopt(hnd, CURLOPT_NOBODY, 1L);
  curl_easy_setopt(hnd, CURLOPT_USERAGENT, "curl/7.74.0");
  curl_easy_setopt(hnd, CURLOPT_FOLLOWLOCATION, 1L);
  curl_easy_setopt(hnd, CURLOPT_MAXREDIRS, 50L);
  curl_easy_setopt(hnd, CURLOPT_HTTP_VERSION, (long)CURL_HTTP_VERSION_2TLS);
  curl_easy_setopt(hnd, CURLOPT_SSL_VERIFYPEER, 0L);
  curl_easy_setopt(hnd, CURLOPT_SSL_VERIFYHOST, 0L);
  curl_easy_setopt(hnd, CURLOPT_FILETIME, 1L);
  curl_easy_setopt(hnd, CURLOPT_FTP_SKIP_PASV_IP, 1L);
  curl_easy_setopt(hnd, CURLOPT_TCP_KEEPALIVE, 1L);
  curl_easy_setopt(hnd, CURLOPT_HEADERFUNCTION, CHECK_HEADERS);

  ret = curl_easy_perform(hnd);
  if (ret != CURLE_OK)
  {
    fprintf(stderr,"[-] Curl Returned Error As: " RED("%s") "\n",curl_easy_strerror(ret));
  }

  curl_easy_cleanup(hnd);
  hnd = NULL;

  return (int)ret;
}
